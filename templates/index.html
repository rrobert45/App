<!DOCTYPE html>
<html>
<head>
    <title>Temperature and Humidity Monitor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function updateValue(variable) {
                let newValue = null;
                if(variable == "start_date") {
                    if(confirm("Updating start date will also clear the historical data. Are you sure you want to continue?")) {
                        newValue = prompt("Enter the new value for " + variable);
                    }
                } else {
                    newValue = prompt("Enter the new value for " + variable);
                }
                if (newValue != null) {
                    $.ajax({
                        type: 'POST',
                        url: '/update_settings',
                        data: JSON.stringify({ variable: variable, value: newValue }),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (response) {
                            alert('Successfully updated ' + variable + ' to ' + newValue);
                        }
                    });
                }
            }
        </script>
</head>
<body class="dark-theme">
    <div class="settings">
        <h1>Settings</h1>
        <table>
            <tr>
              <th>Variable</th>
              <th>Value</th>
              <th>Update</th>
            </tr>
            <tr>
              <td>How often data should be logged</td>
              <td>{{ int(data.log_interval/60) }} minutes</td>
              <td><button class="update-button" onclick="updateValue('log_interval')">Update</button></td>
            </tr>
            <tr>
              <td>Time Between rolling Eggs</td>
              <td>{{ int(data.relay_interval /60/60) }} hours</td>
              <td><button class="update-button" onclick="updateValue('relay_interval')">Update</button></td>
            </tr>
            <tr>
              <td>Egg Roll Time</td>
              <td>{{ int(data.roll_interval/60) }} minutes</td>
              <td><button class="update-button" onclick="updateValue('roll_interval')">Update</button></td>
            </tr>
            <tr>
              <td>Temperature Threshold</td>
              <td>{{ data.temperature_threshold }}F</td>
              <td><button class="update-button" onclick="updateValue('temperature_threshold')">Update</button></td>
            </tr>
            <tr>
              <td>Humidity Threshold</td>
              <td>{{ data.humidity_threshold }} %</td>
              <td><button class="update-button" onclick="updateValue('humidity_threshold')">Update</button></td>
            </tr>
            <tr>
                <td>Start Day</td>
                <td>{{ data.start_date }}</td>
                <td><button class="update-button" onclick="updateValue('start_date')">Update</button></td>
            </tr>
          </table>
    </div>
  <div class="current-data">
    <h1>Current Data</h1>
    <table>
        <tr>
            <th>Temperature (F)</th>
            <th>Temperature Relay Status</th>            
            <th>Humidity (%)</th>
            <th>Humidity Relay Status</th>
            <th>Last Egg Turn</th>
            <th>Day in Egg Cycle</th>

        </tr>
        <tr>
            <td>{{ data.temperature }}</td>
            <td>{{ data.temperature_relay_status }}</td>
            <td>{{ data.humidity }}</td>
            <td>{{ data.humidity_relay_status }}</td>
            <td>{{ data.last_relay_on }}</td>
            <td>{{ data.day_in_cycle }}</td>
        </tr>
    </table>
</div> 
</div>
  <div class="data-table">
    <h1>Historical Data (Last 48 Hours)</h1>
    <table>
      <tr>
        <th>Time</th>
        <th>Temperature (F)</th>
        <th>Humidity(%)</th>
        <th>Temperature Relay Status</th>
        <th>Humidity Relay Status</th>
        <th>Last Egg Turn</th>
        <th>Day in Egg Cycle</th>
      </tr>
      {% for data in data.historical_data %}
          <tr>
            <td>{{ data.Time }}</td>
            <td>{{ data["Temperature(F)"] }}</td>
            <td>{{ data["Humidity(%)"] }}</td>
            <td>{{ data["Temperature Relay Status"] }}</td>
            <td>{{ data["Humidity Relay Status"] }}</td>
            <td>{{ data["Last Egg Turn"] }}</td>
            <td>{{ data["Day in Egg Cycle"] }}</td>

            
          </tr>
      {% endfor %}
  </table>
  </div>
</body>
</html>


